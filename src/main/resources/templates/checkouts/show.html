<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Payment</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <link rel="icon" type="image/png" href="/images/favicon.png" th:href="@{/images/favicon.png}"/>
  <style>
    body {
      background-color: lightgrey;
      justify-content: center;
    }
    .styled-header {
      margin: 0;
      background-color: #1b1b1b;
      color: steelblue;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
    }
    a {
      text-decoration: none;
    }
    .body-content {
      display: flex;
      margin: 0;
      justify-content: center;
      align-items: center;
    }
    .wrapper {
      background-color: whitesmoke;
      border-radius: 6px;
      box-shadow: dimgrey 5px 5px 10px;
      padding-top: 20px;
      padding-bottom: 10px;
      margin: 10px 10% 0 5%;
      width: auto;
      height: auto;
      max-width: 35%;
      min-width: 250px;
      display: flex;
      align-items: center;
    }
    .icon {
      display: flex;
      justify-content: center;
    }
    .description {
      margin-top: 20px;
      background-color: lightgrey;
    }
    .drawer {
      padding-left: 20px;
      padding-right: 20px;
    }

  </style>
</head>
<body>
<header class="styled-header">
  <div class="left-part">
    <a class="pseudoshop" href="/payment/checkouts"><strong>HABIT</strong> TRACKER</a>
  </div>
  <div class="notice-wrapper">
    <div class="show notice error notice-error" th:if="${errorDetails}">
      <span class="notice-message" th:text="${errorDetails}"></span>
    </div>
  </div>
  <div class="right-part">
    <a class="braintree" href="https://developers.braintreepayments.com/guides/drop-in" target="_blank">Braintree</a>
  </div>
</header>

<div class="body-content">
  <div class="wrapper">
    <div class="response container">
      <div class="content">
        <div class="icon">
          <div type="hidden" style="display: none" id="status" th:text="${isSuccess}"></div>
          <img class="success" id="success" src="/images/success.svg" th:src="@{/images/success.svg}" alt="" />
          <img class="not-success" id="not-success" src="/images/fail.svg" th:src="@{/images/fail.svg}" alt="" />
        </div>

        <div id="success-description">
          <h1 style="display: flex; justify-content: center">Успешно!</h1>
          <section>Ваша тестовая транзакция была успешно обработана. Посмотрите ответ API Braintree и попробуйте снова.</section>
          <div class="description">
            Сайт для проверки: <a href="https://sandbox.braintreegateway.com/login" onmouseover="over(this)" onmouseout="out(this)">braintreegateway.com</a>
            <br />
            Логин: <strong onmouseover="over(this)" onmouseout="out(this)" onclick="copyToClipboard(this)">HabitTracker24</strong>
            Пароль: <strong onmouseover="over(this)" onmouseout="out(this)" onclick="copyToClipboard(this)">KRv3bqcq#ia6$S.</strong>
          </div>
        </div>
        <div id="not-success-description">
          <h1 style="display: flex; justify-content: center">Транзакция не удалась</h1>
          <section>Статус вашей тестовой транзакции: <span th:text="${transaction.getStatus()}"/>. Посмотрите ответ API Braintree и попробуйте снова.</section>
        </div>

        <section>
          <a style="margin-top: 20%" class="btn btn-primary back" href="/payment/checkouts/new">
            <span>Попробовать снова</span>
          </a>
        </section>
      </div>
    </div>
  </div>

  <div class="wrapper" style="padding: 10px">
    <aside class="drawer dark">
      <div id="notification"></div>
      <header>
        <div class="content compact">
          <h3>API Response</h3>
        </div>
      </header>

      <article class="content compact">
        <section>
          <h5 style="padding-top: 5px">Transaction</h5>
          <table class="table table-hover">
            <tbody>
            <tr>
              <td>id</td>
              <td th:text="${transaction.getId()}"></td>
            </tr>
            <tr>
              <td>type</td>
              <td th:text="${transaction.getType()}"></td>
            </tr>
            <tr>
              <td>amount</td>
              <td th:text="${transaction.getAmount()}"></td>
            </tr>
            <tr>
              <td>status</td>
              <td th:text="${transaction.getStatus()}"></td>
            </tr>
            <tr>
              <td>created_at</td>
              <td th:text="${createdAt}"></td>
            </tr>
            <tr>
              <td>updated_at</td>
              <td th:text="${updatedAt}"></td>
            </tr>
            </tbody>
          </table>
        </section>

        <section>
          <h5>Payment</h5>

          <table class="table table-hover">
            <tbody>
            <tr>
              <td>token</td>
              <td th:text="${creditCard.getToken()}"></td>
            </tr>
            <tr>
              <td>bin</td>
              <td th:text="${creditCard.getBin()}"></td>
            </tr>
            <tr>
              <td>last_4</td>
              <td th:text="${creditCard.getLast4()}"></td>
            </tr>
            <tr>
              <td>card_type</td>
              <td th:text="${creditCard.getCardType()}"></td>
            </tr>
            <tr>
              <td>expiration_date</td>
              <td th:text="${creditCard.getExpirationDate()}"></td>
            </tr>
            <tr>
              <td>cardholder_name</td>
              <td th:text="${creditCard.getCardholderName()}"></td>
            </tr>
            <tr>
              <td>customer_location</td>
              <td th:text="${creditCard.getCustomerLocation()}"></td>
            </tr>
            </tbody>
          </table>
        </section>

        <section th:if="${customer.getId()}">
          <h5>Customer Details</h5>

          <table class="table table-hover">
            <tbody>
            <tr>
              <td>id</td>
              <td th:text="${customer.getId()}"></td>
            </tr>
            <tr>
              <td>first_name</td>
              <td th:text="${customer.getFirstName()}"></td>
            </tr>
            <tr>
              <td>last_name</td>
              <td th:text="${customer.getLastName()}"></td>
            </tr>
            <tr>
              <td>email</td>
              <td th:text="${customer.getEmail()}"></td>
            </tr>
            <tr>
              <td>company</td>
              <td th:text="${customer.getCompany()}"></td>
            </tr>
            <tr>
              <td>website</td>
              <td th:text="${customer.getWebsite()}"></td>
            </tr>
            <tr>
              <td>phone</td>
              <td th:text="${customer.getPhone()}"></td>
            </tr>
            <tr>
              <td>fax</td>
              <td th:text="${customer.getFax()}"></td>
            </tr>
            </tbody>
          </table>
        </section>

        <section>
          <p class="center small">Integrate with the Braintree SDK for a secure and seamless checkout</p>
        </section>

        <section>
          <a class="button secondary full" href="https://developers.braintreepayments.com/guides/drop-in" target="_blank">
            <span>See the Docs</span>
          </a>
        </section>
      </article>
    </aside>
  </div>

</div>

<script>
  function isSuccess() {
    const status = document.getElementById('status').textContent
    const successImg = document.getElementById('success')
    const notSuccessImg = document.getElementById('not-success')
    const sucDescr = document.getElementById('success-description')
    const notSucDescr = document.getElementById('not-success-description')
    console.log(status)
    if (status === 'true') {
      successImg.style.display = 'block'
      notSuccessImg.style.display = 'none'
      sucDescr.style.display = 'block'
      notSucDescr.style.display = 'none'
    } else {
      successImg.style.display = 'none'
      notSuccessImg.style.display = 'block'
      sucDescr.style.display = 'none'
      notSucDescr.style.display = 'block'
    }
  }

  isSuccess();

  function over(element) {
    element.style.color = 'steelblue';
  }

  function out(element) {
    element.style.color = 'black';
  }

  function copyToClipboard(element) {
    const tempInput = document.createElement('input');
    tempInput.value = element.textContent;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    ShowNotification('Скопировано в буфер обмена ' + tempInput.value);

  }

  function ShowNotification(message) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style = 'position: fixed;\n' +
            '            top: 20px;\n' +
            '            right: 20px;\n' +
            '            background-color: #4CAF50; /* Зеленый цвет */\n' +
            '            color: white;\n' +
            '            padding: 15px;\n' +
            '            border-radius: 5px;\n' +
            '            color: black;\n' +
            '            display: none; /* Скрыто по умолчанию */\n' +
            '            z-index: 1000; /* Поверх других элементов */';
    notification.style.display = 'block';

    // Скрыть уведомление через 10 секунд
    setTimeout(() => {notification.style.display = 'none';}, 10000);
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
</body>
</html>
